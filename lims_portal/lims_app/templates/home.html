<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>eTala - Library Portal</title>
    <link rel="stylesheet" href="https://public.codepenassets.com/css/normalize-5.0.0.min.css">
    <link rel="stylesheet" href="../static/Scripts/css/cadmin.css">
  </head>
    
  <body>
  <div class="app-container">
  <div class="app-header">
    <div class="app-header-left">
      <span class="app-icon"></span>
      <p class="app-name">eTala Library</p>
      <div class="search-wrapper">
        <input class="search-input" type="text" placeholder="Search books...">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="feather feather-search" viewBox="0 0 24 24">
          <defs></defs>
          <circle cx="11" cy="11" r="8"></circle>
          <path d="M21 21l-4.35-4.35"></path>
        </svg>
      </div>
    </div>
    <div class="app-header-right">
      <button class="mode-switch" title="Switch Theme">
        <svg class="moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="24" height="24" viewBox="0 0 24 24">
          <defs></defs>
          <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
        </svg>
      </button>
    </div>
    <button class="messages-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" /></svg>
    </button>
  </div>
  <div class="app-content">
    <div class="app-sidebar">
      <a href="{% url 'home' %}" class="app-sidebar-link active" title="Home">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" /></svg>
      </a>
      <a href="{% url 'records' %}" class="app-sidebar-link" title="Records">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
        </svg>
      </a>
      <a href="{% url 'about' %}" class="app-sidebar-link" title="About">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
      </a>
      <a href="{% url 'analytics' %}" class="app-sidebar-link" title="Statistics">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bar-chart-2">
          <line x1="18" y1="20" x2="18" y2="10"></line>
          <line x1="12" y1="20" x2="12" y2="4"></line>
          <line x1="6" y1="20" x2="6" y2="14"></line>
        </svg>
      </a>
      <a href="#" class="app-sidebar-link" onclick="alert('Activation portal coming soon!'); return false;" title="Activate Account">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user-check">
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="8.5" cy="7" r="4"></circle>
          <polyline points="17 11 19 13 23 9"></polyline>
        </svg>
      </a>
    </div>
</div>
</div>
</div>

    <script  src="../static/Scripts/js/cadmin.js"></script>
    <script>
      function showView(viewName) {
        // Hide all views
        document.getElementById('borrowed-view').style.display = 'none';
        document.getElementById('checkout-view').style.display = 'none';
        document.getElementById('return-view').style.display = 'none';
        
        // Hide sidebar sections
        document.getElementById('sidebar-books').style.display = 'none';
        document.getElementById('sidebar-users').style.display = 'none';
        
        // Show selected view
        document.getElementById(viewName + '-view').style.display = 'block';
        
        // Update sidebar active state
        document.querySelectorAll('.app-sidebar-link').forEach(link => {
          link.classList.remove('active');
        });
        document.querySelector('[data-view="' + viewName + '"]').classList.add('active');
        
        // Auto-focus barcode input when checkout or return view is shown
        if (viewName === 'checkout') {
          setTimeout(() => {
            const checkoutInput = document.getElementById('checkout-barcode-input');
            if (checkoutInput) {
              checkoutInput.focus();
              checkoutInput.select();
            }
          }, 100);
        } else if (viewName === 'return') {
          setTimeout(() => {
            const barcodeInput = document.getElementById('barcode-input');
            if (barcodeInput) {
              barcodeInput.focus();
              barcodeInput.select();
            }
          }, 100);
        }
      }
      
      function toggleSidebarSection(sectionName) {
        const booksSection = document.getElementById('sidebar-books');
        const usersSection = document.getElementById('sidebar-users');
        
        if (sectionName === 'books') {
          if (booksSection.style.display === 'none' || booksSection.style.display === '') {
            booksSection.style.display = 'block';
            usersSection.style.display = 'none';
          } else {
            booksSection.style.display = 'none';
          }
        } else if (sectionName === 'users') {
          if (usersSection.style.display === 'none' || usersSection.style.display === '') {
            usersSection.style.display = 'block';
            booksSection.style.display = 'none';
          } else {
            usersSection.style.display = 'none';
          }
        }
      }

      // Barcode scanner handler
      document.addEventListener('DOMContentLoaded', function() {
        const barcodeForm = document.getElementById('barcode-return-form');
        const barcodeInput = document.getElementById('barcode-input');
        const statusDiv = document.getElementById('barcode-status');

        if (barcodeForm && barcodeInput) {
          // Clear input and refocus after submission
          barcodeForm.addEventListener('submit', function(e) {
            const accessionNumber = barcodeInput.value.trim();
            if (!accessionNumber) {
              e.preventDefault();
              showStatus('Please enter or scan a barcode', 'error');
              return;
            }
          });

          // Auto-clear status message after successful scan
          barcodeInput.addEventListener('input', function() {
            if (statusDiv.style.display === 'block') {
              statusDiv.style.display = 'none';
            }
          });
        }

        function showStatus(message, type) {
          statusDiv.textContent = message;
          statusDiv.style.display = 'block';
          if (type === 'success') {
            statusDiv.style.background = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.borderLeft = '4px solid #28a745';
          } else {
            statusDiv.style.background = '#f8d7da';
            statusDiv.style.color = '#721c24';
            statusDiv.style.borderLeft = '4px solid #dc3545';
          }
        }
      });
      
      // Modal functions
      function openBookEditModal(id, title, mainAuthor, coAuthor, publisher, edition, callNumber, language, type) {
        document.getElementById('editBookId').value = id;
        document.getElementById('editBookTitle').value = title;
        document.getElementById('editBookMainAuthor').value = mainAuthor;
        document.getElementById('editBookCoAuthor').value = coAuthor;
        document.getElementById('editBookPublisher').value = publisher;
        document.getElementById('editBookEdition').value = edition;
        document.getElementById('editBookCallNumber').value = callNumber;
        document.getElementById('editBookLanguage').value = language;
        document.getElementById('editBookType').value = type;
        document.getElementById('editBookModal').style.display = 'flex';
      }
      
      function closeBookEditModal() {
        document.getElementById('editBookModal').style.display = 'none';
      }
      
      function openUserEditModal(schoolId, name, email, grade, batch, isActivated) {
        document.getElementById('editUserSchoolId').value = schoolId;
        document.getElementById('editUserName').value = name;
        document.getElementById('editUserEmail').value = email;
        document.getElementById('editUserSchoolIdDisplay').value = schoolId;
        document.getElementById('editUserGrade').value = grade;
        document.getElementById('editUserGradeDisplay').value = grade;
        document.getElementById('editUserBatch').value = batch;
        document.getElementById('editUserIsActivated').value = isActivated ? 'true' : 'false';
        document.getElementById('editUserModal').style.display = 'flex';
      }
      
      function closeUserEditModal() {
        document.getElementById('editUserModal').style.display = 'none';
      }
      
      // Close modals when clicking outside
      window.onclick = function(event) {
        const bookModal = document.getElementById('editBookModal');
        const userModal = document.getElementById('editUserModal');
        if (event.target === bookModal) {
          closeBookEditModal();
        } else if (event.target === userModal) {
          closeUserEditModal();
        }
      }
      
      // Search functions
      function searchBooks() {
        const input = document.getElementById('bookSearch');
        const filter = input.value.toLowerCase();
        const booksList = document.getElementById('booksList');
        const items = booksList.getElementsByClassName('book-item');
        let visibleCount = 0;
        
        for (let i = 0; i < items.length; i++) {
          const title = items[i].getAttribute('data-title');
          const author = items[i].getAttribute('data-author');
          const accession = items[i].getAttribute('data-accession');
          
          if (title.includes(filter) || author.includes(filter) || accession.includes(filter)) {
            items[i].style.display = '';
            visibleCount++;
          } else {
            items[i].style.display = 'none';
          }
        }
        
        // Show "no results" message if no items visible
        let noResultsMsg = document.getElementById('booksNoResults');
        if (visibleCount === 0 && filter !== '') {
          if (!noResultsMsg) {
            noResultsMsg = document.createElement('p');
            noResultsMsg.id = 'booksNoResults';
            noResultsMsg.style.cssText = 'text-align: center; color: var(--secondary-color); padding: 20px; font-size: 0.8rem;';
            noResultsMsg.textContent = 'No books found';
            booksList.appendChild(noResultsMsg);
          }
        } else if (noResultsMsg) {
          noResultsMsg.remove();
        }
      }
      
      function searchUsers() {
        const input = document.getElementById('userSearch');
        const filter = input.value.toLowerCase();
        const usersList = document.getElementById('usersList');
        const items = usersList.getElementsByClassName('user-item');
        let visibleCount = 0;
        
        for (let i = 0; i < items.length; i++) {
          const name = items[i].getAttribute('data-name');
          const schoolId = items[i].getAttribute('data-schoolid');
          const grade = items[i].getAttribute('data-grade');
          const batch = items[i].getAttribute('data-batch');
          
          if (name.includes(filter) || schoolId.includes(filter) || grade.includes(filter) || batch.includes(filter)) {
            items[i].style.display = '';
            visibleCount++;
          } else {
            items[i].style.display = 'none';
          }
        }
        
        // Show "no results" message if no items visible
        let noResultsMsg = document.getElementById('usersNoResults');
        if (visibleCount === 0 && filter !== '') {
          if (!noResultsMsg) {
            noResultsMsg = document.createElement('p');
            noResultsMsg.id = 'usersNoResults';
            noResultsMsg.style.cssText = 'text-align: center; color: var(--secondary-color); padding: 20px; font-size: 0.8rem;';
            noResultsMsg.textContent = 'No users found';
            usersList.appendChild(noResultsMsg);
          }
        } else if (noResultsMsg) {
          noResultsMsg.remove();
        }
      }
    </script>
  </body>
</html>
